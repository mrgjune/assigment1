import java.io.IOException;

public class CrossCorr {

    public static RGBImage makeGray(RGBImage img) {
        RGBImage gray = new RGBImage(img.getHeight(), img.getWidth());

        for (int r = 0; r < img.getNumRows(); r++) {
            for (int c = 0; c < img.getNumCols(); c++) {
                int grayVal = (int) (img.getPixel(r, c).getRed() * 0.299 + img.getPixel(r, c).getGreen() * 0.587
                        + img.getPixel(r, c).getBlue() * 0.114);
                gray.setPixel(r, c, grayVal, grayVal, grayVal);
            }
        }

        return gray;
    }

    // expect img to be a color image
    // expect mask to be a blurring mask whose values all add up to 1
    // assuming the mask is odd width and odd height
    public static RGBImage crossCorrelate(double[][] mask, RGBImage img, int flag, int value) {
        RGBImage grayInput = makeGray(img);
        RGBImage resultImage = new RGBImage(grayInput);

        int halfMaskWidth = mask[0].length / 2; // half the # of cols
        int halfMaskHeight = mask.length / 2; // half the # of rows

        for (int r = halfMaskHeight; r < grayInput.getNumRows() - halfMaskHeight; r++) {

            for (int c = halfMaskWidth; c < grayInput.getNumCols() - halfMaskWidth; c++) {

                // here we have r,c which is the "center pixel" of a neighborhood
                double result = 0;
                for (int mr = 0; mr < mask.length; mr++) {
                    for (int mc = 0; mc < mask[mr].length; mc++) {

                        result += mask[mr][mc]
                                * grayInput.getPixel(r + mr - halfMaskHeight, c + mc - halfMaskWidth).getRed();

                    }

                }

                resultImage.setPixel(r, c, (int) result, (int) result, (int) result);
            }

        }

        return resultImage;
    }

    public static void checkFlag (int flag) {
        if(flag == 1) {
        //do a divide by the total of the mask before outputting new pixel
        }
        else if(flag == 2) {
            //output only 0 or 255 depending on the comparison of the Math.abs(sum) to the threshold.
        }
    }

    public static void main(String[] args) throws IOException {
        double blurMask[][] = { { 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49 },
                { 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49 },
                { 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49 },
                { 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49 },
                { 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49 },
                { 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49 },
                { 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49, 1.0 / 49 } };
        double gaussianV2[][] = { { 0.00090, 0.00316, 0.00668, 0.00858, 0.00668, 0.00316, 0.00090 },
                { 0.00316, 0.01102, 0.02333, 0.02996, 0.02333, 0.01102, 0.00316 },
                { 0.00668, 0.02333, 0.04940, 0.06342, 0.04940, 0.02333, 0.00668 },
                { 0.00858, 0.02996, 0.06342, 0.08144, 0.06342, 0.02996, 0.00858 },
                { 0.00668, 0.02333, 0.04940, 0.06342, 0.04940, 0.02333, 0.00668 },
                { 0.00316, 0.01102, 0.02333, 0.02996, 0.02333, 0.01102, 0.00316 },
                { 0.00090, 0.00316, 0.00668, 0.00858, 0.00668, 0.00316, 0.00090 } };
        double gaussianV3[][] = {
                { 0.00000, 0.00000, 0.00001, 0.00003, 0.00007, 0.00011, 0.00013, 0.00011, 0.00007, 0.00003, 0.00001,
                        0.00000, 0.00000 },
                { 0.00000, 0.00001, 0.00006, 0.00018, 0.00042, 0.00070, 0.00082, 0.00070, 0.00042, 0.00018, 0.00006,
                        0.00001, 0.00000 },
                { 0.00001, 0.00006, 0.00026, 0.00082, 0.00189, 0.00312, 0.00369, 0.00312, 0.00189, 0.00082, 0.00026,
                        0.00006, 0.00001 },
                { 0.00003, 0.00018, 0.00082, 0.00264, 0.00608, 0.01002, 0.01184, 0.01002, 0.00608, 0.00264, 0.00082,
                        0.00018, 0.00003 },
                { 0.00007, 0.00042, 0.00189, 0.00608, 0.01399, 0.02306, 0.02725, 0.02306, 0.01399, 0.00608, 0.00189,
                        0.00042, 0.00007 },
                { 0.00011, 0.00070, 0.00312, 0.01002, 0.02306, 0.03802, 0.04492, 0.03802, 0.02306, 0.01002, 0.00312,
                        0.00070, 0.00011 },
                { 0.00013, 0.00082, 0.00369, 0.01184, 0.02725, 0.04492, 0.05307, 0.04492, 0.02725, 0.01184, 0.00369,
                        0.00082, 0.00013 },
                { 0.00011, 0.00070, 0.00312, 0.01002, 0.02306, 0.03802, 0.04492, 0.03802, 0.02306, 0.01002, 0.00312,
                        0.00070, 0.00011 },
                { 0.00007, 0.00042, 0.00189, 0.00608, 0.01399, 0.02306, 0.02725, 0.02306, 0.01399, 0.00608, 0.00189,
                        0.00042, 0.00007 },
                { 0.00003, 0.00018, 0.00082, 0.00264, 0.00608, 0.01002, 0.01184, 0.01002, 0.00608, 0.00264, 0.00082,
                        0.00018, 0.00003 },
                { 0.00001, 0.00006, 0.00026, 0.00082, 0.00189, 0.00312, 0.00369, 0.00312, 0.00189, 0.00082, 0.00026,
                        0.00006, 0.00001 },
                { 0.00000, 0.00001, 0.00006, 0.00018, 0.00042, 0.00070, 0.00082, 0.00070, 0.00042, 0.00018, 0.00006,
                        0.00001, 0.00000 },
                { 0.00000, 0.00000, 0.00001, 0.00003, 0.00007, 0.00011, 0.00013, 0.00011, 0.00007, 0.00003, 0.00001,
                        0.00000, 0.00000 } };
            double gaussianV1[][] = {{ 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00000, 0.00000, 0.00001, 0.00003, 0.00005, 0.00003, 0.00001, 0.00000, 0.00000, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00000, 0.00002, 0.00024, 0.00107, 0.00177, 0.00107, 0.00024, 0.00002, 0.00000, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00001, 0.00024, 0.00292, 0.01306, 0.02154, 0.01306, 0.00292, 0.00024, 0.00001, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00003, 0.00107, 0.01306, 0.05855, 0.09653, 0.05855, 0.01306, 0.00107, 0.00003, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00005, 0.00177, 0.02154, 0.09653, 0.15915, 0.09653, 0.02154, 0.00177, 0.00005, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00003, 0.00107, 0.01306, 0.05855, 0.09653, 0.05855, 0.01306, 0.00107, 0.00003, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00001, 0.00024, 0.00292, 0.01306, 0.02154, 0.01306, 0.00292, 0.00024, 0.00001, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00000, 0.00002, 0.00024, 0.00107, 0.00177, 0.00107, 0.00024, 0.00002, 0.00000, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00000, 0.00000, 0.00001, 0.00003, 0.00005, 0.00003, 0.00001, 0.00000, 0.00000, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000},
            { 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000}};
        double gaussianV4[][] = 
            {{ 0.00000, 0.00002, 0.00006, 0.00014, 0.00027, 0.00039, 0.00044, 0.00039, 0.00027, 0.00014, 0.00006, 0.00002, 0.00000},
{ 0.00002, 0.00008, 0.00024, 0.00057, 0.00106, 0.00155, 0.00175, 0.00155, 0.00106, 0.00057, 0.00024, 0.00008, 0.00002},
{ 0.00006, 0.00024, 0.00073, 0.00175, 0.00327, 0.00476, 0.00540, 0.00476, 0.00327, 0.00175, 0.00073, 0.00024, 0.00006},
{ 0.00014, 0.00057, 0.00175, 0.00420, 0.00785, 0.01142, 0.01294, 0.01142, 0.00785, 0.00420, 0.00175, 0.00057, 0.00014},
{ 0.00027, 0.00106, 0.00327, 0.00785, 0.01467, 0.02134, 0.02418, 0.02134, 0.01467, 0.00785, 0.00327, 0.00106, 0.00027},
{ 0.00039, 0.00155, 0.00476, 0.01142, 0.02134, 0.03105, 0.03519, 0.03105, 0.02134, 0.01142, 0.00476, 0.00155, 0.00039},
{ 0.00044, 0.00175, 0.00540, 0.01294, 0.02418, 0.03519, 0.03987, 0.03519, 0.02418, 0.01294, 0.00540, 0.00175, 0.00044},
{ 0.00039, 0.00155, 0.00476, 0.01142, 0.02134, 0.03105, 0.03519, 0.03105, 0.02134, 0.01142, 0.00476, 0.00155, 0.00039},
{ 0.00027, 0.00106, 0.00327, 0.00785, 0.01467, 0.02134, 0.02418, 0.02134, 0.01467, 0.00785, 0.00327, 0.00106, 0.00027},
{ 0.00014, 0.00057, 0.00175, 0.00420, 0.00785, 0.01142, 0.01294, 0.01142, 0.00785, 0.00420, 0.00175, 0.00057, 0.00014},
{ 0.00006, 0.00024, 0.00073, 0.00175, 0.00327, 0.00476, 0.00540, 0.00476, 0.00327, 0.00175, 0.00073, 0.00024, 0.00006},
{ 0.00002, 0.00008, 0.00024, 0.00057, 0.00106, 0.00155, 0.00175, 0.00155, 0.00106, 0.00057, 0.00024, 0.00008, 0.00002},
{ 0.00000, 0.00002, 0.00006, 0.00014, 0.00027, 0.00039, 0.00044, 0.00039, 0.00027, 0.00014, 0.00006, 0.00002, 0.00000}};
        double blurMask315[][] = { { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 },
                { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 },
                { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 },
                { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 },
                { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 }, { 1.0 / 45, 1.0 / 45, 1.0 / 45 },
                { 1.0 / 45, 1.0 / 45, 1.0 / 45 } };

        RGBImage inImg = new RGBImage(args[0]); // reads the image on disk with name args[0] and creates an RGBImage
                                                // object
        RGBImage blurredImg;
        blurredImg = crossCorrelate(gaussianV4, inImg);
        blurredImg.writeImage("blurred13x13V4-" + args[0]);
    }

}